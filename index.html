<!-- Add this button in tracking tab -->
<button class="btn btn-info" onclick="showLuaTracking()">ðŸ”„ View Lua Script Tracking</button>

<!-- Add this section after invalid attempts -->
<div id="luaTracking" style="display: none; margin-top: 30px;">
    <h3>ðŸ“± Lua Script Tracking</h3>
    <div id="luaTrackingTable">
        <div class="loading">Loading Lua tracking data...</div>
    </div>
</div>

<script>
// Add this function
async function showLuaTracking() {
    document.getElementById('luaTracking').style.display = 'block';
    
    try {
        const response = await fetch(GITHUB_API + '/tracking', {
            headers: {
                'Authorization': `token ${GITHUB_TOKEN}`,
                'Accept': 'application/vnd.github.v3+json'
            }
        });
        
        if (response.ok) {
            const files = await response.json();
            const luaFiles = files.filter(file => 
                file.name.startsWith('lua_') && file.name.endsWith('.json')
            );
            
            let tableHTML = '<table><tr><th>Device ID</th><th>Sessions</th><th>Total Time</th><th>Last Used</th><th>Actions</th></tr>';
            
            for (const file of luaFiles) {
                const fileResponse = await fetch(GITHUB_RAW + '/tracking/' + file.name);
                if (fileResponse.ok) {
                    const data = await fileResponse.json();
                    tableHTML += `
                        <tr>
                            <td><code>${data.device_id || file.name.replace('lua_', '').replace('.json', '')}</code></td>
                            <td>${data.sessions?.length || 0}</td>
                            <td>${data.total_time || 0}m</td>
                            <td>${data.last_used ? new Date(data.last_used).toLocaleString() : 'N/A'}</td>
                            <td>
                                <button class="btn btn-primary" onclick="viewLuaDetails('${file.name}')">View</button>
                            </td>
                        </tr>
                    `;
                }
            }
            
            tableHTML += '</table>';
            document.getElementById('luaTrackingTable').innerHTML = tableHTML;
        }
    } catch (error) {
        document.getElementById('luaTrackingTable').innerHTML = 
            `<div class="message error">Error: ${error.message}</div>`;
    }
}

async function viewLuaDetails(fileName) {
    try {
        const response = await fetch(GITHUB_RAW + '/tracking/' + fileName);
        if (response.ok) {
            const data = await response.json();
            alert(JSON.stringify(data, null, 2));
        }
    } catch (error) {
        alert('Error loading details: ' + error.message);
    }
}
</script>
